import { Sql } from 'postgres';

const blogPosts = [
  {
    title: "Alice's first post (published)",
    text_content:
      "This is Alice's first post. It's published, so this is data that all logged-in users are allowed to view.",
    is_published: true,
    user_id: 1,
  },
  {
    title: "Alice's second post (unpublished)",
    text_content:
      "This is Alice's second post. It's not published, so this is private data that only Alice should be able to view and edit.",
    is_published: false,
    user_id: 1,
  },
  {
    title: "Alice's third post (published)",
    text_content:
      "This is Alice's third post. It's published, so this is data that all logged-in users are allowed to view.",
    is_published: true,
    user_id: 1,
  },
  {
    title: "Bob's first post (unpublished)",
    text_content:
      "This is Bob's first post. It's not published, so this is data only Bob should be able to view and edit.",
    is_published: false,
    user_id: 2,
  },
  {
    title: "Bob's second post (published)",
    text_content:
      "This is Bob's second post. It's published, so this is data that all logged-in users are allowed to view.",
    is_published: true,
    user_id: 2,
  },
];

export async function up(sql: Sql<Record<string, string>>) {
  await sql`
    CREATE TABLE IF NOT EXISTS blog_posts (
      id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
      title varchar(100) NOT NULL,
      text_content varchar(2000) NOT NULL,
      is_published boolean NOT NULL DEFAULT false,
      user_id integer REFERENCES users (id) ON DELETE CASCADE
    )
  `;

  await sql`
    INSERT INTO blog_posts ${sql(
      blogPosts,
      'title',
      'text_content',
      'is_published',
      'user_id',
    )}
  `;
}

export async function down(sql: Sql<Record<string, string>>) {
  await sql`DROP TABLE blog_posts`;
}
